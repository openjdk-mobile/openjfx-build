# openjfx-build
In this repository, we create and improve scripts and tools that build OpenJFX for desktop and mobile platforms, using the OpenJDK build system.
This repository contains a number of Github Actions that automate this process.

## Goal

The goal of this repository is to build OpenJFX using the same build procedures (including tools) that are used to build OpenJDK.
Both OpenJDK and OpenJFX have a build system that processes java code and native code into java artifacts (e.g. jmods) and native
libraries. Both build systems use similar tools, e.g. a java compiler, a native compiler and a linker. 

By building OpenJFX from the OpenJDK build system, we eliminate the need to maintain a second buildsystem for OpenJFX. Another 
advantage is that this approach allows, if desired, to build a JDK containing the JavaFX modules. As a consequence, java developers
can compile and run JavaFX applications without having to add the JavaFX modules manually to the modulepath.

It is very important that we can always build the latest OpenJDK code with the latest OpenJFX code. Maintainability is a crucial 
requirement, and we should be able to automatically create builds that produce a JVM + JDK based on the latest OpenJDK sources and 
including the JavaFX modules from the latest OpenJFX sources.

## How it works

This repository contain scripts in the [.github/workflows](.github/workflows) directory. Currently, we have a
[a script for linux](.github/workflows/build-openjfx.yml) and [a script for mac](.github/workflows/build-openjfx-mac.yml)
The scripts in this repository do the following:

* Download the latest OpenJDK/mobile code
* apply a small patch to this code, where the patch is obtained from this repository
* Download the latest OpenJFX code
* run a gradle task that builds the sources for the shader classes 
* configure the JDK build
* make a JDK image

### Download the latest OpenJDK/mobile code

The OpenJDK/mobile repository at https://github.com/openjdk/mobile is downstream from the official OpenJDK 
repository at https://github.com/openjdk/jdk.
The diff between those repositories is very small, and it is one of the goals of the OpenJDK project to 
minimize the differences, and eventually removing them completely. When that is completed, there is no need 
for an OpenJDK/mobile repository anymore -- but we're not there yet.
Because we want to build the OpenJDK + OpenJFX artifacts for desktop and mobile platforms, it makes sense to
use the code in openjdk/mobile as the base for all builds. We want to minimze differences between mobile and
desktop platforms, so we prefer not to use different openjdk source repositories for desktop versus mobile. 

### Path the OpenJKD/mobile code

Currently, the openjdk/jdk (and hence, the downstream openjdk/mobile) build system does not have a mechanism
that allows to build modules with external source code (there is an option to include already built modules, 
but we need to build the modules first). Hence, we need a (small) patch to the OpenJDK codebase that allows
to build the javafx modules, using the code from the openjfx repository (rather than copying the javafx source
code inside the openjdk repository). 
This patch is maintained into this repository, in `openjdk-ext/src/jfx.patch`. The patch adds a configuration option
`with_openjfx_modules` which should point to a repository containing the openjfx sources. Also, the patch 
contains the module-specific gmk files, which describe module-specific build rules. This is where we specify for
example what native libraries are needed when linking the glass libraries. 

This is not a perfect/permanent solution. We want this patch to become obsolete one day, but for now, it does the
job and the required maintenance is expected to be very low.

### Download the latest OpenJFX code

We need to have the openjfx sources accessible to the OpenJDK build system, so they must be downloaded locally.

### Build the shader classes

JavaFX heavily uses shader classes that are compiled from generated Java code. The Java code is generated by
a parser, which is currently only available in the OpenJFX build system. It is a goal that this code generation is
handled by the OpenJDK build system as well, but for now, the scripts will generate them using a gradle command
inside the openjfx repository

### Configure the build

The standard OpenJDK configuration is used, with the addition of the `with_openjfx_modules` option.

### Make an image

The standard OpenJDK `make` command is used, and an image is created using a JVM + JDK, including the JavaFX modules.


